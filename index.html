<!DOCTYPE html>
<html lang="ko">
<head>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#4f46e5">
<meta name="apple-mobile-web-app-capable" content="yes">

<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('./sw.js')
      .then(() => console.log("ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡ ì™„ë£Œ!"))
      .catch((err) => console.log("ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡ ì‹¤íŒ¨:", err));
  }
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>í”„ë¡œ í™ˆíŠ¸ ë§¤ë‹ˆì € v2.0</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --main: #4f46e5; --bg: #f8fafc; --card: #ffffff; --text: #1e293b; --sub: #64748b; --danger: #ef4444; --accent: #10b981; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: 'Pretendard', sans-serif; }
        body { background-color: var(--bg); margin: 0; padding-bottom: 110px; color: var(--text); }
        .container { width: 100%; max-width: 500px; margin: 0 auto; padding: 20px; }
        
        .page { display: none; }
        .active-page { display: block; }

        /* ë©”ì¸ í—¤ë” */
        .header { text-align: center; padding: 10px 0; }
        .score-value { font-size: 3.5rem; font-weight: 900; color: var(--main); margin: 0; letter-spacing: -2px; }
        .main-progress { width: 100%; height: 12px; background: #e2e8f0; border-radius: 10px; margin: 15px 0; overflow: hidden; }
        .main-bar { width: 0%; height: 100%; background: var(--main); transition: width 0.5s ease; }

        /* ì¶”ê°€ UI */
        .add-box { display: flex; gap: 8px; margin-bottom: 25px; }
        #newName { flex: 1; border: 1px solid #e2e8f0; padding: 14px; border-radius: 15px; outline: none; background: white; }
        .add-btn { background: var(--text); color: white; border: none; padding: 0 20px; border-radius: 15px; font-weight: bold; cursor: pointer; }

        /* ìš´ë™ ì¹´ë“œ */
        .card { background: white; border-radius: 25px; padding: 18px; margin-bottom: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.03); display: flex; align-items: center; justify-content: space-between; }
        .info-area { flex: 1.2; }
        .name-row { display: flex; align-items: center; gap: 8px; }
        .name { font-size: 1.1rem; font-weight: 800; }
        .del-btn { background: #fee2e2; border: none; color: var(--danger); width: 22px; height: 22px; border-radius: 50%; font-size: 0.8rem; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .goal-row { font-size: 0.8rem; color: var(--sub); font-weight: 600; margin-top: 4px; }
        .goal-input { width: 45px; border: 1px solid #e2e8f0; border-radius: 6px; text-align: center; font-weight: 800; color: var(--main); }

        /* ì¤‘ì•™ ë‹¬ì„±ë¥  */
        .item-percent { flex: 0.7; text-align: center; font-size: 1.2rem; font-weight: 900; color: var(--main); }

        .counter { display: flex; align-items: center; gap: 10px; flex: 1.1; justify-content: flex-end; }
        .btn-circle { width: 34px; height: 34px; border-radius: 10px; border: none; background: #f1f5f9; font-weight: bold; cursor: pointer; }
        .btn-plus { background: var(--main); color: white; }

        /* ìƒì„¸ ë¶„ì„ */
        .stats-section { margin-top: 30px; background: white; border-radius: 25px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        #statItemSelector { border: 1px solid #e2e8f0; padding: 8px; border-radius: 10px; font-weight: 800; color: var(--main); }
        .stats-tabs { display: flex; gap: 5px; margin: 15px 0; background: #f1f5f9; padding: 5px; border-radius: 12px; }
        .tab-btn { flex: 1; border: none; background: none; padding: 8px; font-size: 0.8rem; font-weight: 800; color: var(--sub); cursor: pointer; }
        .tab-btn.active { background: white; color: var(--main); border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }

        /* ìƒì„¸ ê°€ì´ë“œ ìŠ¤íƒ€ì¼ (v1.6 ë³µêµ¬) */
        .guide-item { background: white; border-radius: 25px; padding: 25px; margin-bottom: 20px; border-left: 6px solid var(--main); box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .guide-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .guide-title { font-size: 1.3rem; font-weight: 800; }
        .guide-tag { font-size: 0.7rem; background: #eef2ff; color: var(--main); padding: 3px 8px; border-radius: 6px; font-weight: 700; }
        .section-label { font-size: 0.8rem; font-weight: 800; color: var(--accent); display: block; margin: 10px 0 3px; }
        .section-content { font-size: 0.9rem; line-height: 1.5; color: var(--sub); margin: 0; }

        /* ì‚¬ì§„ì²© */
        .photo-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
        .photo-card { background: white; padding: 8px; border-radius: 18px; box-shadow: 0 4px 10px rgba(0,0,0,0.02); }
        .photo-img { width: 100%; aspect-ratio: 1; object-fit: cover; border-radius: 12px; }

        /* ë„¤ë¹„ê²Œì´ì…˜ */
        .nav { position: fixed; bottom: 0; left: 0; right: 0; background: rgba(255,255,255,0.95); backdrop-filter: blur(10px); display: flex; justify-content: space-around; padding: 15px 0 35px; border-top: 1px solid #f1f5f9; z-index: 100; }
        .nav-item { border: none; background: none; color: var(--sub); font-size: 0.85rem; font-weight: 800; }
        .nav-item.active { color: var(--main); }
    </style>
</head>
<body>

<div class="container">
    <div id="routinePage" class="page active-page">
        <div class="header">
            <span id="displayDate" style="color:var(--sub); font-weight: 800;">2026.02.17</span>
            <p class="score-value" id="totalScore">0%</p>
            <div class="main-progress"><div class="main-bar" id="mainBar"></div></div>
        </div>
        <div class="add-box">
            <input type="text" id="newName" placeholder="ìš´ë™ ì¶”ê°€ (ì˜ˆ: ë³µê·¼ ë¡¤ì•„ì›ƒ)">
            <button class="add-btn" onclick="addRoutine()">ì¶”ê°€</button>
        </div>
        <div id="routineList"></div>
        <div class="stats-section">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <span style="font-weight:900;">í•­ëª©ë³„ ë¶„ì„</span>
                <select id="statItemSelector" onchange="updateStatsDisplay()"></select>
            </div>
            <div class="stats-tabs">
                <button class="tab-btn active" onclick="changeRange('week', this)">ì£¼ê°„</button>
                <button class="tab-btn" onclick="changeRange('month', this)">ì›”ê°„(ì£¼ê°„ëª¨ìŒ)</button>
                <button class="tab-btn" onclick="changeRange('year', this)">ë…„ê°„</button>
            </div>
            <div style="height: 160px;"><canvas id="statsChart"></canvas></div>
        </div>
    </div>

    <div id="photoPage" class="page">
        <h2 style="font-weight: 900; margin-bottom: 20px;">Body History</h2>
        <input type="file" id="photoInput" accept="image/*" style="display: none;" onchange="handlePhoto(this)">
        <button onclick="document.getElementById('photoInput').click()" style="background:var(--text); color:white; border:none; padding:18px; border-radius:20px; width:100%; font-weight:800; margin-bottom:20px;">ğŸ“¸ ì˜¤ëŠ˜ ëˆˆë°”ë”” ë‚¨ê¸°ê¸°</button>
        <div class="photo-grid" id="photoGrid"></div>
    </div>

    <div id="guidePage" class="page">
        <h2 style="font-weight: 900; margin-bottom: 25px;">Workout Manual</h2>
        <div id="guideList"></div>
    </div>
</div>

<nav class="nav">
    <button class="nav-item active" onclick="showPage('routine', this)">ğŸ”¥ íŠ¸ë˜ì»¤</button>
    <button class="nav-item" onclick="showPage('photo', this)">ğŸ“· ëˆˆë°”ë””</button>
    <button class="nav-item" onclick="showPage('guide', this)">ğŸ“˜ ê°€ì´ë“œ</button>
</nav>

<script>
    const guideDB = {
        "í”Œë­í¬": { tag: "ì½”ì–´", prep: "íŒ”ê¿ˆì¹˜ë¥¼ ë°”ë‹¥ì— ëŒ€ê³  ì—ë“œë¦½ë‹ˆë‹¤.", action: "ëª¸ì„ ì¼ì§ì„ ìœ¼ë¡œ ìœ ì§€í•˜ë©° ë²„íŒë‹ˆë‹¤.", tip: "ë°°ê¼½ì„ ë“±ìª½ìœ¼ë¡œ ë‹¹ê²¨ ë³µì••ì„ ìœ ì§€í•˜ì„¸ìš”." },
        "ë³µê·¼ ë¡¤ì•„ì›ƒ": { tag: "ê³ ê°•ë„ ì½”ì–´", prep: "ë¬´ë¦ì„ ëŒ€ê³  ë¡¤ëŸ¬ ì†ì¡ì´ë¥¼ ì¡ìŠµë‹ˆë‹¤.", action: "ì²œì²œíˆ ë°€ê³  ë‚˜ê°”ë‹¤ê°€ ë³µê·¼ í˜ìœ¼ë¡œ ëŒì•„ì˜µë‹ˆë‹¤.", tip: "í—ˆë¦¬ê°€ êº¾ì´ì§€ ì•Šê²Œ ë“±ì„ ì‚´ì§ ë§ì•„ì£¼ì„¸ìš”." },
        "ìŠ¤ì¿¼íŠ¸": { tag: "í•˜ì²´", prep: "ë°œì„ ì–´ê¹¨ë„ˆë¹„ë¡œ ë²Œë¦¬ê³  ì„­ë‹ˆë‹¤.", action: "ì—‰ë©ì´ë¥¼ ë’¤ë¡œ ë¹¼ë©° ì•‰ì•˜ë‹¤ ì¼ì–´ë‚©ë‹ˆë‹¤.", tip: "ë¬´ë¦ì´ ì•ˆìœ¼ë¡œ êµ½ì§€ ì•Šê²Œ í•˜ì„¸ìš”." },
        "í‘¸ì‹œì—…": { tag: "ê°€ìŠ´", prep: "ì†ì„ ë„“ê²Œ ì§šê³  ëª¸ì„ ì¼ì§ì„ ìœ¼ë¡œ ë§Œë“­ë‹ˆë‹¤.", action: "ê°€ìŠ´ì´ ë‹¿ê¸° ì „ê¹Œì§€ ë‚´ë ¤ê°”ë‹¤ ë°€ì–´ ì˜¬ë¦½ë‹ˆë‹¤.", tip: "ì–´ê¹¨ë¥¼ ê·€ì™€ ë©€ë¦¬ ìœ ì§€í•˜ì„¸ìš”." }
    };

    let allRoutines = JSON.parse(localStorage.getItem('allRoutines')) || ["í”Œë­í¬", "ë³µê·¼ ë¡¤ì•„ì›ƒ", "ìŠ¤ì¿¼íŠ¸"];
    let history = JSON.parse(localStorage.getItem('workoutHistory')) || {};
    let goals = JSON.parse(localStorage.getItem('workoutGoals')) || {};
    let photos = JSON.parse(localStorage.getItem('bodyPhotos')) || [];
    let currentRange = 'week';
    let chart;

    function showPage(pageId, el) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active-page'));
        document.getElementById(pageId + 'Page').classList.add('active-page');
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        el.classList.add('active');
        if(pageId === 'photo') renderPhotos();
        if(pageId === 'guide') renderGuide();
    }

    function addRoutine() {
        const name = document.getElementById('newName').value.trim();
        if (name && !allRoutines.includes(name)) {
            allRoutines.push(name); goals[name] = 30;
            document.getElementById('newName').value = ""; render();
        }
    }

    function removeRoutine(name) {
        if (confirm(`'${name}' ì‚­ì œí• ê¹Œìš”?`)) {
            allRoutines = allRoutines.filter(i => i !== name); render();
        }
    }

    function updateCount(name, val) {
        const today = new Date().toISOString().split('T')[0];
        if(!history[today]) history[today] = {};
        history[today][name] = Math.max(0, (history[today][name] || 0) + val);
        render();
    }

    function handlePhoto(input) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = (e) => {
                photos.unshift({ date: new Date().toLocaleDateString(), src: e.target.result });
                localStorage.setItem('bodyPhotos', JSON.stringify(photos));
                renderPhotos();
            };
            reader.readAsDataURL(input.files[0]);
        }
    }

    function renderPhotos() {
        document.getElementById('photoGrid').innerHTML = photos.map(p => `
            <div class="photo-card"><img src="${p.src}" class="photo-img"><div style="text-align:center; font-size:0.7rem; color:var(--sub); margin-top:5px;">${p.date}</div></div>
        `).join('');
    }

    function changeRange(range, el) {
        currentRange = range;
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        el.classList.add('active');
        updateStatsDisplay();
    }

    function updateStatsDisplay() {
        const selected = document.getElementById('statItemSelector').value;
        if(!selected) return;
        const now = new Date();
        let labels = [], data = [];

        if(currentRange === 'week') {
            for(let i=6; i>=0; i--) {
                const d = new Date(now); d.setDate(now.getDate() - i);
                const dStr = d.toISOString().split('T')[0];
                labels.push(d.toLocaleDateString('ko-KR', {weekday:'short'}));
                data.push((history[dStr] && history[dStr][selected]) || 0);
            }
        } else if(currentRange === 'month') {
            for(let w=3; w>=0; w--) {
                let sum = 0;
                for(let d=0; d<7; d++) {
                    const target = new Date(now); target.setDate(now.getDate() - (w*7 + d));
                    sum += (history[target.toISOString().split('T')[0]] && history[target.toISOString().split('T')[0]][selected]) || 0;
                }
                labels.push(`${4-w}ì£¼ì°¨`); data.push(sum);
            }
        } else {
            for(let m=5; m>=0; m--) {
                const d = new Date(now); d.setMonth(now.getMonth() - m);
                labels.push(`${d.getMonth()+1}ì›”`); data.push(Math.floor(Math.random()*100)+50);
            }
        }
        renderChart(labels, data);
    }

    function renderChart(labels, data) {
        const ctx = document.getElementById('statsChart').getContext('2d');
        if(chart) chart.destroy();
        chart = new Chart(ctx, {
            type: 'bar',
            data: { labels, datasets: [{ data, backgroundColor: '#4f46e5', borderRadius: 8 }] },
            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { display: false }, x: { grid: { display: false } } } }
        });
    }

    function render() {
        const today = new Date().toISOString().split('T')[0];
        const list = document.getElementById('routineList');
        const selector = document.getElementById('statItemSelector');
        const currentSelected = selector.value;
        selector.innerHTML = allRoutines.map(name => `<option value="${name}" ${name===currentSelected?'selected':''}>${name}</option>`).join('');
        if(!selector.value) selector.value = allRoutines[0];

        list.innerHTML = "";
        let curS = 0, goalS = 0;

        allRoutines.forEach(name => {
            const count = (history[today] && history[today][name]) || 0;
            const goal = goals[name] || 30;
            const pct = goal > 0 ? Math.round((count/goal)*100) : 0;
            curS += count; goalS += goal;
            list.innerHTML += `
                <div class="card">
                    <div class="info-area">
                        <div class="name-row"><span class="name">${name}</span><button class="del-btn" onclick="removeRoutine('${name}')">Ã—</button></div>
                        <div class="goal-row">ëª©í‘œ <input type="number" class="goal-input" value="${goal}" onchange="goals['${name}']=parseInt(this.value); render();"></div>
                    </div>
                    <div class="item-percent">${pct}%</div>
                    <div class="counter">
                        <button class="btn-circle" onclick="updateCount('${name}', -1)">-</button>
                        <span style="font-weight:900; min-width:25px; text-align:center;">${count}</span>
                        <button class="btn-circle btn-plus" onclick="updateCount('${name}', 1)">+</button>
                    </div>
                </div>`;
        });
        const total = goalS > 0 ? Math.min(Math.round((curS / goalS) * 100), 100) : 0;
        document.getElementById('totalScore').innerText = total + "%";
        document.getElementById('mainBar').style.width = total + "%";
        document.getElementById('displayDate').innerText = new Date().toLocaleDateString('ko-KR', {year:'numeric', month:'long', day:'numeric'});
        updateStatsDisplay();
        localStorage.setItem('workoutHistory', JSON.stringify(history));
        localStorage.setItem('workoutGoals', JSON.stringify(goals));
        localStorage.setItem('allRoutines', JSON.stringify(allRoutines));
    }

    function renderGuide() {
        const gl = document.getElementById('guideList'); gl.innerHTML = "";
        allRoutines.forEach(name => {
            const d = guideDB[name] || { tag: "ê¸°íƒ€", prep: "ìì„¸ë¥¼ ì¤€ë¹„í•©ë‹ˆë‹¤.", action: "ë™ì‘ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.", tip: "ë¶€ìƒì— ì£¼ì˜í•˜ì„¸ìš”." };
            gl.innerHTML += `
                <div class="guide-item">
                    <div class="guide-header"><span class="guide-title">${name}</span><span class="guide-tag">${d.tag}</span></div>
                    <span class="section-label">ì¤€ë¹„</span><p class="section-content">${d.prep}</p>
                    <span class="section-label">ë™ì‘</span><p class="section-content">${d.action}</p>
                    <p style="margin-top:10px; font-size:0.85rem; color:#92400e; background:#fffbeb; padding:10px; border-radius:10px;">ğŸ’¡ <b>Tip:</b> ${d.tip}</p>
                </div>`;
        });
    }
    render();
</script>
</body>
</html>