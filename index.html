<!DOCTYPE html>
<html lang="ko">
<head>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#4f46e5">
<meta name="apple-mobile-web-app-capable" content="yes">
<link rel="apple-touch-icon" href="icon-192.png">

<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('./sw.js')
      .then(() => console.log("S1 ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡ ì™„ë£Œ!"))
      .catch((err) => console.log("ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡ ì‹¤íŒ¨:", err));
  }
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>í”„ë¡œ í™ˆíŠ¸ ë§¤ë‹ˆì € S1</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --main: #4f46e5; --bg: #f8fafc; --card: #ffffff; --text: #1e293b; --sub: #64748b; --danger: #ef4444; --accent: #10b981; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: 'Pretendard', sans-serif; }
        body { background-color: var(--bg); margin: 0; padding-bottom: 110px; color: var(--text); }
        .container { width: 100%; max-width: 500px; margin: 0 auto; padding: 20px; }
        .page { display: none; }
        .active-page { display: block; }

        .header { text-align: center; padding: 10px 0; }
        .score-value { font-size: 3.5rem; font-weight: 900; color: var(--main); margin: 0; letter-spacing: -2px; }
        .main-progress { width: 100%; height: 12px; background: #e2e8f0; border-radius: 10px; margin: 15px 0; overflow: hidden; }
        .main-bar { width: 0%; height: 100%; background: var(--main); transition: width 0.5s ease; }
        
        .add-box { display: flex; gap: 8px; margin-bottom: 25px; }
        #newName { flex: 1; border: 1px solid #e2e8f0; padding: 14px; border-radius: 15px; outline: none; background: white; font-weight: 600; }
        .add-btn { background: var(--text); color: white; border: none; padding: 0 20px; border-radius: 15px; font-weight: bold; cursor: pointer; }

        .card { background: white; border-radius: 25px; padding: 18px; margin-bottom: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.03); display: flex; align-items: center; justify-content: space-between; }
        .name { font-size: 1.1rem; font-weight: 800; }
        .goal-input { width: 45px; border: 1px solid #e2e8f0; border-radius: 6px; text-align: center; font-weight: 800; color: var(--main); }
        .item-percent { flex: 0.7; text-align: center; font-size: 1.2rem; font-weight: 900; color: var(--main); }
        .btn-circle { width: 34px; height: 34px; border-radius: 10px; border: none; background: #f1f5f9; font-weight: bold; cursor: pointer; }
        .btn-plus { background: var(--main); color: white; }

        .stats-section { margin-top: 30px; background: white; border-radius: 25px; padding: 22px; box-shadow: 0 10px 30px rgba(0,0,0,0.04); }
        .stats-tabs { display: flex; gap: 8px; margin: 18px 0; background: #f1f5f9; padding: 6px; border-radius: 16px; }
        .tab-btn { flex: 1; border: none; background: none; padding: 10px; font-size: 0.85rem; font-weight: 800; color: var(--sub); cursor: pointer; transition: all 0.2s ease; border-radius: 12px; }
        .tab-btn.active { background: var(--main); color: white; box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3); }

        /* [ìˆ˜ì •] ê°€ì´ë“œ ë””ìì¸ ë° í…ìŠ¤íŠ¸ ì •ë ¬ */
        .guide-card { background: white; border-radius: 25px; padding: 20px; margin-bottom: 20px; box-shadow: 0 8px 20px rgba(0,0,0,0.04); border-left: 6px solid var(--main); }
        .guide-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .guide-title { font-size: 1.25rem; font-weight: 900; }
        .guide-badge { font-size: 0.7rem; background: #eef2ff; color: var(--main); padding: 4px 10px; border-radius: 50px; font-weight: 800; }
        .guide-body { background: #f8fafc; border-radius: 15px; padding: 15px; }
        .guide-step-label { font-size: 0.8rem; font-weight: 900; color: var(--main); display: block; margin-bottom: 5px; text-transform: uppercase; }
        .guide-step-text { font-size: 0.95rem; color: var(--text); margin-bottom: 15px; font-weight: 500; line-height: 1.6; word-break: keep-all; }
        .guide-tip { margin-top: 15px; background: #fffbeb; padding: 12px; border-radius: 12px; border: 1px dashed #fcd34d; font-size: 0.85rem; color: #92400e; font-weight: 600; line-height: 1.5; }

        .photo-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
        .photo-card { background: white; padding: 8px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); position: relative; }
        .photo-img { width: 100%; aspect-ratio: 1; object-fit: cover; border-radius: 15px; }
        .photo-del { position: absolute; top: 12px; right: 12px; background: var(--danger); color: white; border: none; border-radius: 50%; width: 26px; height: 26px; font-weight: bold; cursor: pointer; border: 2px solid white; }
        .clear-photos-btn { width: 100%; background: none; border: 1.5px solid #e2e8f0; color: var(--sub); padding: 14px; border-radius: 18px; font-size: 0.85rem; font-weight: 800; margin-top: 20px; cursor: pointer; }

        .nav { position: fixed; bottom: 0; left: 0; right: 0; background: rgba(255,255,255,0.9); backdrop-filter: blur(15px); display: flex; justify-content: space-around; padding: 15px 0 35px; border-top: 1px solid #f1f5f9; z-index: 100; }
        .nav-item { border: none; background: none; color: var(--sub); font-size: 0.85rem; font-weight: 800; cursor: pointer; }
        .nav-item.active { color: var(--main); }
    </style>
</head>
<body>

<div class="container">
    <div id="routinePage" class="page active-page">
        <div class="header">
            <span id="displayDate" style="color:var(--sub); font-weight: 800; font-size: 0.9rem;"></span>
            <p class="score-value" id="totalScore">0%</p>
            <div class="main-progress"><div class="main-bar" id="mainBar"></div></div>
        </div>
        <div class="add-box"><input type="text" id="newName" placeholder="ìƒˆ ìš´ë™ ì¶”ê°€..."><button class="add-btn" onclick="addRoutine()">ì¶”ê°€</button></div>
        <div id="routineList"></div>
        <div class="stats-section">
            <div style="display:flex; justify-content:space-between; align-items:center;"><span style="font-weight:900; font-size:1.1rem;">ê¸°ë¡ ë¶„ì„</span><select id="statItemSelector" style="border:none; color:var(--main); font-weight:900;" onchange="updateStatsDisplay()"></select></div>
            <div class="stats-tabs">
                <button class="tab-btn active" onclick="changeRange('week', this)">ì£¼ê°„</button>
                <button class="tab-btn" onclick="changeRange('month', this)">ì›”ê°„</button>
                <button class="tab-btn" onclick="changeRange('year', this)">ë…„ê°„</button>
            </div>
            <div style="height: 170px;"><canvas id="statsChart"></canvas></div>
        </div>
    </div>

    <div id="photoPage" class="page">
        <h2 style="font-weight: 900; margin-bottom: 20px;">Passion History</h2>
        <input type="file" id="photoInput" accept="image/*" style="display: none;" onchange="processPhoto(this)">
        <button onclick="document.getElementById('photoInput').click()" style="background:var(--main); color:white; border:none; padding:18px; border-radius:20px; width:100%; font-weight:800; margin-bottom:25px; box-shadow: 0 10px 20px rgba(79, 70, 229, 0.2);">ğŸ”¥ ì˜¤ëŠ˜ì˜ ì—´ì • ë‚¨ê¸°ê¸°</button>
        <div id="photoGrid" class="photo-grid"></div>
        <button class="clear-photos-btn" onclick="clearAllPhotos()">ëª¨ë“  ì—´ì • ì‚­ì œí•˜ê¸°</button>
    </div>

    <div id="guidePage" class="page"><h2 style="font-weight: 900; margin-bottom: 25px;">Workout Manual</h2><div id="guideList"></div></div>
</div>

<nav class="nav">
    <button class="nav-item active" onclick="showPage('routine', this)">ğŸ”¥ íŠ¸ë˜ì»¤</button>
    <button class="nav-item" onclick="showPage('photo', this)">ğŸ“· ëˆˆë°”ë””</button>
    <button class="nav-item" onclick="showPage('guide', this)">ğŸ“˜ ê°€ì´ë“œ</button>
</nav>

<script>
    // [ë³´ê°•] ë” ë””í…Œì¼í•´ì§„ ìš´ë™ ê°€ì´ë“œ DB
    const guideDB = {
        "í”Œë­í¬": { 
            tag: "ì½”ì–´/ì „ì‹ ", 
            prep: "ë°”ë‹¥ì— ì—ë“œë¦° ìƒíƒœì—ì„œ íŒ”ê¿ˆì¹˜ë¥¼ ì–´ê¹¨ë„ˆë¹„ë¡œ ë²Œë ¤ ì§€ë©´ì— ëŒ€ê³ , ì–‘ì†ì€ ê°€ë³ê²Œ ê¹ì§€ë¥¼ ë¼ê±°ë‚˜ ë°”ë‹¥ì„ ì§šìŠµë‹ˆë‹¤. ë°œê°€ë½ì„ ì„¸ì›Œ í•˜ì²´ë¥¼ ê³ ì •í•©ë‹ˆë‹¤.", 
            action: "ë³µë¶€ì— í˜ì„ ì£¼ì–´ ëª¸ì„ ë“¤ì–´ ì˜¬ë¦½ë‹ˆë‹¤. ì´ë•Œ ë¨¸ë¦¬, ì–´ê¹¨, í—ˆë¦¬, ê³¨ë°˜, ë’¤ê¿ˆì¹˜ê°€ ì¼ì§ì„ ì´ ë˜ì–´ì•¼ í•˜ë©°, ì—‰ë©ì´ê°€ ìœ„ë¡œ ì†Ÿê±°ë‚˜ í—ˆë¦¬ê°€ ì•„ë˜ë¡œ êº¾ì´ì§€ ì•Šë„ë¡ ëê¹Œì§€ ê¸´ì¥ì„ ìœ ì§€í•©ë‹ˆë‹¤.", 
            tip: "ì‹œì„ ì€ ë°”ë‹¥ì„ ë°”ë¼ë³´ê³  í˜¸í¡ì€ ë©ˆì¶”ì§€ ë§ê³  ì§§ê²Œ ê³„ì† ë‚´ë±‰ìœ¼ì„¸ìš”. ì½”ì–´ ê·¼ìœ¡ì´ íƒ€ë“¤ì–´ ê°€ëŠ” ëŠë‚Œì— ì§‘ì¤‘í•´ì•¼ í•©ë‹ˆë‹¤." 
        },
        "ë³µê·¼ ë¡¤ì•„ì›ƒ": { 
            tag: "ê³ ê°•ë„ ì½”ì–´", 
            prep: "ë°”ë‹¥ì— ë¬´ë¦ì„ ëŒ€ê³  íœ  ì†ì¡ì´ë¥¼ ì–‘ì†ìœ¼ë¡œ ê½‰ ì¡ìŠµë‹ˆë‹¤. ë“±ì„ ê³ ì–‘ì´ì²˜ëŸ¼ ì‚´ì§ ë‘¥ê¸€ê²Œ ë§ì•„ ë³µê·¼ì— ë¯¸ë¦¬ í˜ì„ ì¤ë‹ˆë‹¤.", 
            action: "ìˆ¨ì„ ë“¤ì´ë§ˆì‹œë©° ì²œì²œíˆ íœ ì„ ì•ìœ¼ë¡œ êµ´ë ¤ ë‚˜ê°‘ë‹ˆë‹¤. ë³µë¶€ì˜ í˜ìœ¼ë¡œ ë²„í‹¸ ìˆ˜ ìˆëŠ” í•œê³„ì ê¹Œì§€ ë‚´ë ¤ê°”ë‹¤ê°€, ìˆ¨ì„ ë‚´ë±‰ìœ¼ë©° ë³µê·¼ì„ ìˆ˜ì¶•ì‹œì¼œ ì›ìœ„ì¹˜ë¡œ ëŒì•„ì˜µë‹ˆë‹¤.", 
            tip: "í—ˆë¦¬ê°€ ë°”ë‹¥ ìª½ìœ¼ë¡œ êº¾ì´ë©´ ì‹¬ê°í•œ ë¶€ìƒì„ ì…ì„ ìˆ˜ ìˆìœ¼ë‹ˆ ì£¼ì˜í•˜ì„¸ìš”. íŒ”ì˜ í˜ì´ ì•„ë‹Œ ë³µë¶€ì˜ í˜ìœ¼ë¡œ ë‹¹ê²¨ì˜¤ëŠ” ê²ƒì´ í•µì‹¬ì…ë‹ˆë‹¤." 
        },
        "ìŠ¤ì¿¼íŠ¸": { 
            tag: "í•˜ì²´/ëŒ€í‡´ì‚¬ë‘", 
            prep: "ì–‘ë°œì„ ì–´ê¹¨ë„ˆë¹„ë¡œ ë²Œë¦¬ê³  ë°œëì€ ìì—°ìŠ¤ëŸ½ê²Œ 15~30ë„ ì •ë„ ë°”ê¹¥ì„ í–¥í•˜ê²Œ ì„­ë‹ˆë‹¤. ê°€ìŠ´ì„ í´ê³  ì‹œì„ ì€ ì •ë©´ì„ ì‘ì‹œí•©ë‹ˆë‹¤.", 
            action: "ë¬´ë¦ì„ êµ½íˆë©° ì—‰ë©ì´ë¥¼ ë’¤ë¡œ ë¹¼ê³  ì•‰ìŠµë‹ˆë‹¤. í—ˆë²…ì§€ê°€ ì§€ë©´ê³¼ í‰í–‰ì´ ë  ë•Œê¹Œì§€ ë‚´ë ¤ê°„ í›„, ë°œë“±ì´ ì•„ë‹Œ ë°œë’¤ê¿ˆì¹˜ì— ë¬´ê²Œ ì¤‘ì‹¬ì„ ë‘ê³  ì§€ë©´ì„ ë°€ì–´ë‚´ë“¯ ì¼ì–´ë‚©ë‹ˆë‹¤.", 
            tip: "ë‚´ë ¤ê°ˆ ë•Œ ë¬´ë¦ì´ ë°œëë³´ë‹¤ ë„ˆë¬´ ì•ìœ¼ë¡œ ë‚˜ì˜¤ì§€ ì•Šë„ë¡ ì£¼ì˜í•˜ê³ , ì¼ì–´ë‚  ë•Œ ë¬´ë¦ì´ ì•ˆìª½ìœ¼ë¡œ ë§ë¦¬ì§€ ì•Šë„ë¡ ë°”ê¹¥ìª½ìœ¼ë¡œ í˜ì„ ì£¼ì„¸ìš”." 
        }
    };

    let allRoutines = JSON.parse(localStorage.getItem('allRoutines')) || ["í”Œë­í¬", "ë³µê·¼ ë¡¤ì•„ì›ƒ", "ìŠ¤ì¿¼íŠ¸"];
    let history = JSON.parse(localStorage.getItem('workoutHistory')) || {};
    let goals = JSON.parse(localStorage.getItem('workoutGoals')) || {};
    let photos = JSON.parse(localStorage.getItem('bodyPhotos')) || [];
    let currentRange = 'week', chart;

    function showPage(pageId, el) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active-page'));
        document.getElementById(pageId + 'Page').classList.add('active-page');
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        el.classList.add('active');
        if(pageId === 'photo') renderPhotos();
        if(pageId === 'guide') renderGuide();
    }

    // [ë³µêµ¬ ë° ê°•í™”] ì‚¬ì§„ ì••ì¶• ë° ë¦¬ìŠ¤íŠ¸ ë°˜ì˜ ë¡œì§
    function processPhoto(input) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function (e) {
                const img = new Image();
                img.onload = function () {
                    const canvas = document.createElement('canvas');
                    const MAX_WIDTH = 600;
                    let width = img.width, height = img.height;
                    if (width > MAX_WIDTH) { height *= MAX_WIDTH / width; width = MAX_WIDTH; }
                    canvas.width = width; canvas.height = height;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, width, height);
                    const compressedBase64 = canvas.toDataURL('image/jpeg', 0.6);
                    
                    photos.unshift({ id: Date.now(), date: new Date().toLocaleDateString(), src: compressedBase64 });
                    try { 
                        localStorage.setItem('bodyPhotos', JSON.stringify(photos)); 
                        renderPhotos(); 
                    } catch (e) { 
                        alert("ì €ì¥ ê³µê°„ì´ ë¶€ì¡±í•©ë‹ˆë‹¤. ì´ì „ ì‚¬ì§„ì„ ì‚­ì œí•´ì£¼ì„¸ìš”."); 
                        photos.shift();
                    }
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(input.files[0]);
        }
    }

    function renderPhotos() {
        const grid = document.getElementById('photoGrid');
        if(!grid) return;
        grid.innerHTML = photos.map(p => `
            <div class="photo-card"><img src="${p.src}" class="photo-img"><button class="photo-del" onclick="deletePhoto(${p.id})">Ã—</button>
            <div style="text-align:center; font-size:0.75rem; color:var(--sub); margin-top:8px; font-weight:700;">${p.date}</div></div>`).join('');
    }

    function deletePhoto(id) { if(confirm("ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) { photos = photos.filter(p => p.id !== id); localStorage.setItem('bodyPhotos', JSON.stringify(photos)); renderPhotos(); } }
    function clearAllPhotos() { if(confirm("ëª¨ë“  ì‚¬ì§„ì„ ì‚­ì œí• ê¹Œìš”?")) { photos = []; localStorage.setItem('bodyPhotos', JSON.stringify(photos)); renderPhotos(); } }

    function renderGuide() {
        const gl = document.getElementById('guideList'); if(!gl) return;
        gl.innerHTML = "";
        allRoutines.forEach(name => {
            const d = guideDB[name] || { tag: "ê¸°íƒ€", prep: "ìì„¸ë¥¼ ì¤€ë¹„í•©ë‹ˆë‹¤.", action: "ì •í™•í•œ ë™ì‘ìœ¼ë¡œ ìš´ë™ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.", tip: "ë¶€ìƒì„ ì¡°ì‹¬í•˜ê³  í˜¸í¡ì— ì§‘ì¤‘í•˜ì„¸ìš”." };
            gl.innerHTML += `<div class="guide-card"><div class="guide-header"><span class="guide-title">${name}</span><span class="guide-badge">${d.tag}</span></div>
                <div class="guide-body"><span class="guide-step-label">ì¤€ë¹„ ë° ìì„¸</span><p class="guide-step-text">${d.prep}</p>
                <span class="guide-step-label">ìˆ˜í–‰ ë°©ë²•</span><p class="guide-step-text">${d.action}</p></div>
                <div class="guide-tip">ğŸ’¡ ê³ ìˆ˜ì˜ Tip: ${d.tip}</div></div>`;
        });
    }

    function changeRange(range, el) { currentRange = range; document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active')); el.classList.add('active'); updateStatsDisplay(); }
    function updateStatsDisplay() {
        const selected = document.getElementById('statItemSelector').value;
        if(!selected) return;
        const now = new Date(); let labels = [], data = [];
        if(currentRange === 'week') {
            for(let i=6; i>=0; i--) { const d = new Date(now); d.setDate(now.getDate()-i); const dStr = d.toISOString().split('T')[0]; labels.push(d.toLocaleDateString('ko-KR',{weekday:'short'})); data.push((history[dStr] && history[dStr][selected]) || 0); }
        } else if(currentRange === 'month') {
            for(let w=3; w>=0; w--) { let sum = 0; for(let d=0; d<7; d++) { const t = new Date(now); t.setDate(now.getDate()-(w*7+d)); sum += (history[t.toISOString().split('T')[0]] && history[t.toISOString().split('T')[0]][selected]) || 0; } labels.push(`${4-w}ì£¼ì°¨`); data.push(sum); }
        } else if(currentRange === 'year') {
            for(let m=11; m>=0; m--) { const tm = new Date(now.getFullYear(), now.getMonth()-m, 1); let ms = 0; Object.keys(history).forEach(ds => { const d = new Date(ds); if(d.getFullYear()===tm.getFullYear() && d.getMonth()===tm.getMonth()) ms += history[ds][selected]||0; }); labels.push(`${tm.getMonth()+1}ì›”`); data.push(ms); }
        }
        renderChart(labels, data);
    }
    function renderChart(labels, data) {
        const canvas = document.getElementById('statsChart');
        if(!canvas) return;
        const ctx = canvas.getContext('2d');
        if(chart) chart.destroy();
        chart = new Chart(ctx, { type: 'bar', data: { labels, datasets: [{ data, backgroundColor: '#4f46e5', borderRadius: 8 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true }, x: { grid: { display: false } } } } });
    }
    function render() {
        const today = new Date().toISOString().split('T')[0];
        const list = document.getElementById('routineList');
        const selector = document.getElementById('statItemSelector');
        if(!list || !selector) return;
        const currentSelected = selector.value;
        selector.innerHTML = allRoutines.map(name => `<option value="${name}" ${name===currentSelected?'selected':''}>${name}</option>`).join('');
        if(!selector.value) selector.value = allRoutines[0];
        list.innerHTML = ""; let curS = 0, goalS = 0;
        allRoutines.forEach(name => {
            const count = (history[today] && history[today][name]) || 0;
            const goal = goals[name] || 30;
            curS += count; goalS += goal;
            list.innerHTML += `<div class="card"><div style="flex:1.2;"><div style="display:flex;align-items:center;gap:8px;"><span class="name">${name}</span><button style="border:none;background:#fee2e2;color:var(--danger);border-radius:50%;width:20px;height:20px;font-size:0.7rem;" onclick="removeRoutine('${name}')">Ã—</button></div><div style="font-size:0.8rem;color:var(--sub);margin-top:4px;">ëª©í‘œ <input type="number" class="goal-input" value="${goal}" onchange="goals['${name}']=parseInt(this.value); render();"></div></div><div class="item-percent">${goal > 0 ? Math.round((count/goal)*100) : 0}%</div><div style="display:flex;align-items:center;gap:10px;flex:1.1;justify-content:flex-end;"><button class="btn-circle" onclick="updateCount('${name}',-1)">-</button><span style="font-weight:900;min-width:25px;text-align:center;">${count}</span><button class="btn-circle btn-plus" onclick="updateCount('${name}',1)">+</button></div></div>`;
        });
        const total = goalS > 0 ? Math.min(Math.round((curS / goalS) * 100), 100) : 0;
        document.getElementById('totalScore').innerText = total + "%";
        document.getElementById('mainBar').style.width = total + "%";
        document.getElementById('displayDate').innerText = new Date().toLocaleDateString('ko-KR', {year:'numeric', month:'long', day:'numeric'});
        updateStatsDisplay();
        localStorage.setItem('workoutHistory', JSON.stringify(history)); localStorage.setItem('workoutGoals', JSON.stringify(goals)); localStorage.setItem('allRoutines', JSON.stringify(allRoutines));
    }
    function addRoutine() { const n = document.getElementById('newName').value.trim(); if(n && !allRoutines.includes(n)) { allRoutines.push(n); goals[n]=30; document.getElementById('newName').value=""; render(); } }
    function removeRoutine(n) { if(confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) { allRoutines=allRoutines.filter(i=>i!==n); render(); } }
    function updateCount(n, v) { const t = new Date().toISOString().split('T')[0]; if(!history[t]) history[t]={}; history[t][n]=Math.max(0,(history[t][n]||0)+v); render(); }
    render();
</script>
</body>
</html>